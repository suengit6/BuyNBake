<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BuyNBakeRecipes</title>

    <!-- links -->
    <link rel="icon" type="image/x-icon" href="https://cdn-icons-png.flaticon.com/512/4241/4241664.png">

    <link href="https://fonts.googleapis.com/css2?family=Jacques+Francois&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <link rel="stylesheet" href="../css/shop.css">
    <link rel="stylesheet" href="../css/nav.css">
    <link rel="stylesheet" href="../css/footer.css">


</head>
<body>

    <nav class="navbar navbar-expand-lg d-flex flex-column p-0 border-body position-absolute" style="width: 100%;" id="navbarContainer">
    </nav> <!--modular-->

    <main class="d-flex justify-content-center flex-column pt-5">
        <div class="top-text d-flex text-center justify-content-center flex-column" style="height: 40vh;">
            <h2 class="text-center mt-5">Shop</h2>
            <h5 class="text-center mx-auto">"Shop premium baking essentials at BuyNbakeRecipes. Explore quality ingredients and kits, carefully curated for your baking success. <br> Secure and elevate your culinary experience with us!"</h5>
        </div>

        <div class="mt-5 row align-items-center mx-auto">
            <div class="col-6">
                <label for="viewCart">Ingredients</label>
            </div>
            <div class="col-6 p-0">
                <button class="px-5 btn" id="viewCart" style="width: auto;">View Cart</button>
            </div>
        </div>

        <div class="container-fluid mx-auto position-absolute z-2" id="cartContainer" style="height: 80vh; top: 15vh; display: none;">

            <div class="card shadow-sm" style="height: 100%; width: 100%;">

                <div class="d-flex flex-row-reverse">
                    <button onclick="closeCart()" style="padding: 0.5rem 1rem; border-radius: 0 0.375rem 0 0; border: none;">Ã—</button>
                    </div>
        
                <hr class="m-0">

                <div class="m-0" id="cartContents">
                    
                </div>
                <hr>
                <p id="totalPrice">Total Product Price: Php 0.00</p>
                <button id="clearCartButton">Clear Cart.</button>
                <button id="purchaseButton">Place Order.</button>
            </div>

        </div>


        <div class="row p-5 m-0">
            <div class="col-lg-3">
                <div class="card mb-3" data-product-id="eggs">
                    <div class="card-title text-center py-2 m-0">Eggs</div>
                    <div class="card-body d-flex flex-column pt-0">
                        <h5 class="card-header mb-3">Php 10.00</h5>
                        <input class="mb-3 quantityInput" type="number" min="0">
                        <button class="btn">Add to my order.</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card mb-3" data-product-id="flour">
                    <div class="card-title text-center py-2 m-0">Flour 0.5kg</div>
                    <div class="card-body d-flex flex-column pt-0">
                        <h5 class="card-header mb-3">Php 30.00</h5>
                        <input class="mb-3 quantityInput" type="number" min="0">
                        <button class="btn">Add to my order.</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card mb-3" data-product-id="yeast">
                    <div class="card-title text-center py-2 m-0">Yeast 0.5kg</div>
                    <div class="card-body d-flex flex-column pt-0">
                        <h5 class="card-header mb-3">Php 30.00</h5>
                        <input class="mb-3 quantityInput" type="number" min="0">
                        <button class="btn">Add to my order.</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card mb-3" data-product-id="parchmentPaper">
                    <div class="card-title text-center py-2 m-0">Parchment Paper</div>
                    <div class="card-body d-flex flex-column pt-0">
                        <h5 class="card-header mb-3">Php 40.00</h5>
                        <input class="mb-3 quantityInput" type="number" min="0">
                        <button class="btn">Add to my order.</button>
                    </div>
                </div>
            </div>  
        </div>
        <div class="row p-5 m-0">
            <div class="col-lg-3">
                <div class="card mb-3" data-product-id="sugar">
                    <div class="card-title text-center py-2 m-0">Sugar 1kg</div>
                    <div class="card-body d-flex flex-column pt-0">
                        <h5 class="card-header mb-3">Php 65.00</h5>
                        <input class="mb-3 quantityInput" type="number" min="0">
                        <button class="btn">Add to my order.</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card mb-3" data-product-id="bakingPowder">
                    <div class="card-title text-center py-2 m-0">Baking Powder 0.5kg</div>
                    <div class="card-body d-flex flex-column pt-0">
                        <h5 class="card-header mb-3">Php 35.00</h5>
                        <input class="mb-3 quantityInput" type="number" min="0">
                        <button class="btn">Add to my order.</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card mb-3" data-product-id="bakingSoda">
                    <div class="card-title text-center py-2 m-0">Baking Soda 0.5kg</div>
                    <div class="card-body d-flex flex-column pt-0">
                        <h5 class="card-header mb-3">Php 30.00</h5>
                        <input class="mb-3 quantityInput" type="number" min="0">
                        <button class="btn">Add to my order.</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card mb-3" data-product-id="granulatedSugar">
                    <div class="card-title text-center py-2 m-0">Granulated Sugar 1kg</div>
                    <div class="card-body d-flex flex-column pt-0">
                        <h5 class="card-header mb-3">Php 75.00</h5>
                        <input class="mb-3 quantityInput" type="number" min="0">
                        <button class="btn">Add to my order.</button>
                    </div>
                </div>
            </div>  
        </div>
        <div class="row p-5 m-0">
            <div class="col-lg-3">
                <div class="card mb-3" data-product-id="oats">
                    <div class="card-title text-center py-2 m-0">Oats 1kg</div>
                    <div class="card-body d-flex flex-column pt-0">
                        <h5 class="card-header mb-3">Php 100.00</h5>
                        <input class="mb-3 quantityInput" type="number" min="0">
                        <button class="btn">Add to my order.</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card mb-3" data-product-id="butter">
                    <div class="card-title text-center py-2 m-0">Butter</div>
                    <div class="card-body d-flex flex-column pt-0">
                        <h5 class="card-header mb-3">Php 40.00</h5>
                        <input class="mb-3 quantityInput" type="number" min="0">
                        <button class="btn">Add to my order.</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card mb-3" data-product-id="milk">
                    <div class="card-title text-center py-2 m-0">Milk 1L</div>
                    <div class="card-body d-flex flex-column pt-0">
                        <h5 class="card-header mb-3">Php 120.00</h5>
                        <input class="mb-3 quantityInput" type="number" min="0">
                        <button class="btn">Add to my order.</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card mb-3" data-product-id="vanillaExtract">
                    <div class="card-title text-center py-2 m-0">Vanilla Extract</div>
                    <div class="card-body d-flex flex-column pt-0">
                        <h5 class="card-header mb-3">Php 20.00</h5>
                        <input class="mb-3 quantityInput" type="number" min="0">
                        <button class="btn">Add to my order.</button>
                    </div>
                </div>
            </div>  
        </div>
        <div class="row p-5 m-0">
            <div class="col-lg-3">
                <div class="card mb-3" data-product-id="chocolateChips">
                    <div class="card-title text-center py-2 m-0">Chocolate chips</div>
                    <div class="card-body d-flex flex-column pt-0">
                        <h5 class="card-header mb-3">Php 20.00</h5>
                        <input class="mb-3 quantityInput" type="number" min="0">
                        <button class="btn">Add to my order.</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card mb-3" data-product-id="honey">
                    <div class="card-title text-center py-2 m-0">Honey 0.75L</div>
                    <div class="card-body d-flex flex-column pt-0">
                        <h5 class="card-header mb-3">Php 80.00</h5>
                        <input class="mb-3 quantityInput" type="number" min="0">
                        <button class="btn">Add to my order.</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card mb-3" data-product-id="cream">
                    <div class="card-title text-center py-2 m-0">Cream 0.5L</div>
                    <div class="card-body d-flex flex-column pt-0">
                       <h5 class="card-header mb-3">Php 20.00</h5>
                        <input class="mb-3 quantityInput" type="number" min="0">
                        <button class="btn">Add to my order.</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card mb-3" data-product-id="salt">
                    <div class="card-title text-center py-2 m-0">Salt 1Kg</div>
                    <div class="card-body d-flex flex-column pt-0">
                        <h5 class="card-header mb-3">Php 30.00</h5>
                        <input class="mb-3 quantityInput" type="number" min="0">
                        <button class="btn" id="addToCart">Add to my order.</button>
                    </div>
                </div>
            </div>  
        </div>


    </main>

    <footer style="background-color: #1F1300; color: white;" id="footerContainer">
    </footer> <!--modular-->

    <!-- scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <script src="../templating/navpages.js" defer></script>
    <script src="../templating/footer.js" defer></script>
    
    <script src="https://kit.fontawesome.com/8d8079de50.js" crossorigin="anonymous"></script>

    <script defer>
        function closeCart() {
            const cartContainer = document.getElementById('cartContainer');
            cartContainer.style.display = "none";
        }
    
        document.addEventListener('DOMContentLoaded', function () {
            const isLoggedIn = localStorage.getItem('loggedIn') === 'true';
    
            if (!isLoggedIn) {
                window.location.href = 'login.html';
                return;
            }
    
            const userAccount = JSON.parse(localStorage.getItem('userAccount')) || { userId: generateUserId() };
            let cart = getCartFromLocalStorage(userAccount.userId);
    
            function generateUserId() {
                return Math.random().toString(36).substr(2, 9);
            }
    
            function getCartFromLocalStorage(userId) {
                return JSON.parse(localStorage.getItem(`cart_${userId}`)) || {};
            }
    
            function updateCartContentsText() {
                const cartContentsElement = document.getElementById('cartContents');
                if (Object.keys(cart).length === 0) {
                    cartContentsElement.innerHTML = '<p>Cart is empty</p>';
                }
            }
    
            function clearCart() {
                localStorage.setItem(`cart_${userAccount.userId}`, JSON.stringify({}));
                cart = getCartFromLocalStorage(userAccount.userId);
    
                updateCartContentsText();
    
                const totalPriceElement = document.getElementById('totalPrice');
                totalPriceElement.innerText = 'Total Product Price: Php 0.00';
            }
    
            function purchase() {
                const cart = getCartFromLocalStorage(userAccount.userId);
    
                if (Object.keys(cart).length === 0) {
                    alert('Your cart is empty. Add items to the cart before making a purchase.');
                    return;
                }
    
                const cartData = JSON.stringify(cart);
                window.location.href = 'placeOrder.html';
            }
    
            function displayCart() {
                const cartContentsElement = document.getElementById('cartContents');
                const cartContainer = document.getElementById('cartContainer');
                const totalPriceElement = document.getElementById('totalPrice');
    
                let totalPrice = 0;
    
                cartContentsElement.innerHTML = '';
    
                for (const productId in cart) {
                    const { quantity, price } = cart[productId];
                    totalPrice += quantity * price;
    
                    const productParagraph = document.createElement('p');
                    productParagraph.innerText = `Product Name: ${productId}, Quantity: ${quantity}, Price: Php ${price.toFixed(2)}`;
                    cartContentsElement.appendChild(productParagraph);
                }
    
                totalPriceElement.innerText = `Total Product Price: Php ${totalPrice.toFixed(2)}`;
    
                cartContainer.style.display = "block";
                cartContainer.style.position = "absolute";
                window.scrollTo(0, 0);
            }
    
            function addToCart(productId, quantity, price) {
                // Check if cart is empty before adding a product
                if (Object.keys(cart).length === 0) {
                    localStorage.setItem(`cart_${userAccount.userId}`, JSON.stringify({}));
                    cart = getCartFromLocalStorage(userAccount.userId);
                }
    
                cart[productId] = {
                    quantity: (cart[productId]?.quantity || 0) + quantity,
                    price: price
                };
    
                const updatedCart = {};
                for (const productId in cart) {
                    updatedCart[productId] = {
                        quantity: cart[productId].quantity,
                        price: cart[productId].price
                    };
                }
    
                localStorage.setItem(`cart_${userAccount.userId}`, JSON.stringify(updatedCart));
    
                alert(`Added ${quantity} ${productId}(s) to your cart.`);
            }
    
            const viewCartButton = document.getElementById('viewCart');
            const clearCartButton = document.getElementById('clearCartButton');
            const purchaseButton = document.getElementById('purchaseButton');
    
            if (viewCartButton) {
                viewCartButton.addEventListener('click', displayCart);
            }
    
            if (clearCartButton) {
                clearCartButton.addEventListener('click', clearCart);
            }
    
            if (purchaseButton) {
                purchaseButton.addEventListener('click', purchase);
            }
    
            const addToCartButtons = document.querySelectorAll('.btn');
            addToCartButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const productCard = button.closest('.card');
                    const productId = productCard.getAttribute('data-product-id');
                    const quantityInput = productCard.querySelector('.quantityInput');
                    const productPrice = parseFloat(productCard.querySelector('.card-header.mb-3').innerText.replace('Php ', ''));
                    const quantity = parseInt(quantityInput.value);
    
                    if (isNaN(quantity) || quantity <= 0) {
                        alert('Please enter a valid quantity.');
                        return;
                    }
    
                    addToCart(productId, quantity, productPrice);
                });
            });
        });
    </script>

</body>
</html>